;;; -*- Lisp -*-
(load "script-support.lisp")
(load-asdf)
(with-test ()
 (let* ((fasl1 (asdf:compile-file-pathname* (truename "file1.lisp")))
        (fasl2 (asdf:compile-file-pathname* (truename "file2.lisp")))
        (ns1 (asdf::native-namestring fasl1))
        (ns2 (asdf::native-namestring fasl2)))
   (asdf:run-shell-command "rm -f ~A ~A" ns1 ns2)
   (setf asdf:*central-registry* '(*default-pathname-defaults*))
   (DBG "should load file1 but not file2")
   (asdf:load-system :test3)
   (assert (probe-file fasl1))
   (assert (not (probe-file fasl2)))

   (assert (not (component-property (find-system 'test3) :foo)))
   (assert (equal (component-property (find-system 'test3) :prop1) "value"))
   (setf (component-property (find-system 'test3) :foo) "bar")
   (assert (equal (component-property (find-system 'test3) :foo) "bar"))))

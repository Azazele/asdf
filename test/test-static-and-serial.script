;;; -*- Lisp -*-
(load "script-support.lisp")
(load-asdf)

(in-package :asdf-test)

#+gcl (trace coerce-pathname)

(quit-on-error
 (format t "dpd: ~S~%f1: ~S~%" *default-pathname-defaults* (asdf::merge-pathnames* "file1"))

 (setf asdf:*central-registry* '(*default-pathname-defaults*))

 (asdf:operate 'asdf:load-op 'static-and-serial)
 (let* ((file1 (asdf:compile-file-pathname* "file1.lisp"))
        (file1-date (file-write-date file1)))
   (assert file1-date)
   (format t "file: ~S~%date: ~S~%" file1 file1-date)

   ;; date should stay same
   (asdf:clear-system 'static-and-serial)
   (sleep 1)
   (asdf:operate 'asdf:load-op 'static-and-serial)
   (assert (equal (file-write-date file1) file1-date))))

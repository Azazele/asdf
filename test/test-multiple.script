;;; -*- Lisp -*-

(defparameter asd (subpathname *test-directory* "test-multiple.asd"))
(defparameter tmp (subpathname *test-directory* "../build/"))
(defparameter asd2 (subpathname tmp "test-multiple-too.asd"))
(defparameter file4 (test-fasl "file4"))
(setf *central-registry* `(,*test-directory* ,tmp))

;; Don't rely on ln -s on Windows
(cond
  ((os-unix-p)
   (run-program
    (format nil "ln -sf ~A ~A"
            (native-namestring asd)
            (native-namestring asd2)))
   (oos 'load-source-op 'test-multiple-too))
  (t
   (oos 'load-source-op 'test-multiple)))
(assert (asymval :*file3* :test-package))
(load-system 'test-multiple-free)
(assert (probe-file* file4))

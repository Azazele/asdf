;;; -*- Lisp -*-
(load "script-support.lisp")
(load-asdf)

(quit-on-error
 (let* ((asd (merge-pathnames* (coerce-pathname "test-multiple.asd")
                               *test-directory*))
        (tmp (merge-pathnames* (coerce-pathname "../tmp/")
                               *test-directory*))
        (asd2 (merge-pathnames* (coerce-pathname "test-multiple-too.asd")
                                     tmp))
        (file4 (compile-file-pathname* "file4")))
   (setf *central-registry* `(*default-pathname-defaults* ,tmp))
   (assert (= 0 (run-shell-command
                 (format nil "/bin/ln -sf ~A ~A"
                         (native-namestring asd)
                         (native-namestring asd2)))))
   (oos 'load-source-op 'test-multiple-too)
   (assert (symbol-value (find-symbol (string :*file3*) :test-package)))
   (load-system 'test-multiple-free)
   (assert (asdf::probe-file* file4))))
